This lab is a merge of what is originally Lab 4 and Lab 5 of the curriculum. This is meant for students who have had this curriculum before. If you have little experience with electronics, breadboarding, Arduino programming or the Arduino hardware, please work on Lab 4 and Lab 5 separately!

The alt-pre-Lab helps you to get set up in advance of in-class lab.

## Pre-Lab for Lab 4

For the upcoming lab, we will be building data loggers.

0. PRE-SOLDERING: To avoid the backup around the soldering irons this time in lab, solder connectors onto your LIS3DH accelerometer. 

<img src="https://cdn-shop.adafruit.com/1200x900/466-02.jpg"  width="200" >


1. STATE DIAGRAMS: To sketch out how your interactive devices should act in different modes, we will be using state diagrams. Please review this tutorial on [Everything to Know about State Diagrams](https://www.smartdraw.com/state-diagram/)

2. (optional) I2C: In the upcoming lab, the accelerometer and proximity sensor share the same communication bus! Here is a quick example of how that works. http://www.mbeddedc.com/2017/05/i2c-bus-communication-protocol-tutorial.html

3. READING: This is intended to help you understand what it means to prototype and test interactions: Bill Moggridge, Designing Interactions, [Chapter 10](http://www.designinginteractions.com/downloads/DesigningInteractions_10.pdf) 

4. IDEA GENERATION: The point of this week's lab is to figure out a cool interaction that you can make possible with the a micro controller which can record data generated by a sensor, and then play it back.  You could make programmable piano. You could make that records how much you toss and turn at night. You could make something that measures the changing light levels in your room. 

## PreLab 5
For next week's lab, we'll be making useless boxes. For the lab, we'll have readymade files for you to customize and laser cut. However, we'd like you to take a moment to think about how to make a box with a hinged lid. 
1. Take a look at this [useless box example](https://makezine.com/projects/the-most-useless-machine/) and try to create one out of paper in less than 30 minutes. 
1. Where will the switch, Arduino, and servo go? 
1. Submit a picture of your paper prototype! Bonus points if you submit a timelapse of the process. 


[[https://github.com/FAR-Lab/Developing-and-Designing-Interactive-Devices/wiki/images/paper-prototype.JPG]]

# Data Logger (and using cool sensors!)

For this lab, we will be experimenting with a variety of sensors, sending the data to the Arduino serial monitor, writing data to the EEPROM of the Arduino, and then playing the data back.

## Overview

What's in this lab?

A. [Writing to the Serial Monitor](#part-a--writing-to-the-serial-monitor)

B. [RGB LED](#part-b-rgb-led)

C. [Resistance & Voltage Varying Sensors](#part-c-resistance--voltage-varying-sensors)

D. [I2C Sensors](https://github.com/FAR-Lab/Developing-and-Designing-Interactive-Devices/wiki/Lab-03#part-d-i2c-sensors)

E. [Logging Values to the EEPROM and Reading Them Back](#part-f-logging-values-to-the-eeprom-and-reading-them-back)

F. [Create your own Data logger!](#part-g-create-your-own-data-logger)

## In The Report
For the report, make a copy of this wiki page for your own repository, and then delete everything but the headers and the sections between the **stars**. Write the answers to the questions under the starred sentences. Include snippets of code that explain what you did.

Deliverables are due next Tuesday. Post a link to the wiki page on your main class hub page.

## Part A.  Writing to the Serial Monitor
 
![pot schematic](https://github.com/FAR-Lab/Developing-and-Designing-Interactive-Devices/wiki/images/Pot_schem.png)
 
The OLED display from the Lab 02 is a great and helpful tool for debug purposes; the serial monitor is another. Use the code from `File->Examples->Communication->Graph` as a template to print data from your potentiometer to the serial monitor. Don't disconnect the USB cable after uploading the code; instead, use the serial monitor button on the Arduino IDE (in the upper right corner, magnifying glass icon) to see the data coming from the Arduino. 
 
**a. Based on the readings from the serial monitor, what is the range of the analog values being read?**
 
**b. How many bits of resolution does the analog to digital converter (ADC) on the Arduino have** (hint: where might you look to find this sort of thing)? How many are you using with the range of values you're seeing?
 
You can also read inputs from the serial monitor, or wait for the serial monitor to open before spewing data over the USB line! A nice tutorial on the basic serial transmit functions can be found at http://arduino.cc/en/Tutorial/AnalogReadSerial. 

NEW!!! Also you can plot the data with the Arduino Serial Plotter! This can be found under `Tools->Serial Plotter`. Try it out.
 
For this lab, you can use the serial monitor, plotter and/or the LCD whenever you are told to display something, depending on what you think is easier/prettier.

## Part B. RGB LED

In your kit, you have a "common anode RGB LED." This means that the three LEDs in the RGB package share a common power source, and turn on when the R, G, or B legs have a low enough voltage to cause current to flow. The LONGEST leg is the "common anode" and should be connected to power (do you need a resistor?). The rest of the legs will be connected to pins based on the code you decide to use. 

**You should add the LEDs in the schematic below.**

![RGB LED schematic](https://github.com/FAR-Lab/Developing-and-Designing-Interactive-Devices/wiki/images/rgbled.png)

<!--Modify the Fade code from Lab 1 so that you have the R, G and B leads of the LED on pins 9, 10 and 11, respectively. You will want to change the code so that you can fade each of the colors separately.-->
[Here is sample code](https://learn.adafruit.com/adafruit-arduino-lesson-3-rgb-leds/arduino-sketch) that controls the color of an RGB LED using the Arduino.  

<!--**How might you use this with only the parts in your kit? Show us your solution.**-->

## Part C. Resistance & Voltage Varying Sensors 
One of the useful aspects of the Arduino is the multitude of analog input pins. We'll explore this more now.
 
### FSR
Now that you have a set up that lets you look at changes in the analog voltage from the potentiometer, let's swap in other analog sensors!

<img src=https://cdn-shop.adafruit.com/1200x900/166-00.jpg alt="FSR" width=400>

The FSR (force sensitive resistor) changes resistance — in this case when pressure is applied to the FSR. [Here's the datasheet](https://cdn-shop.adafruit.com/datasheets/FSR400Series_PD.pdf). We'll use a voltage divider with a 27kOhm resistor, using the analog input with the previous potentiometer code. (Feel free to use a 10kOhm resistor instead, or anything in this range.)

![Voltage Divider](https://github.com/FAR-Lab/Developing-and-Designing-Interactive-Devices/wiki/images/fsr_voltage_divider.png)

We need a voltage divider because the Arduino can't measure resistance directly, which is the thing that changes when you physically interact with the sensor. A voltage divider circuit converts a change in resistance to a change in voltage.

**a. What voltage values do you see from your force sensor?**

**b. What kind of relationship does the voltage have as a function of the force applied? (e.g., linear?)**

**c. In `Examples->Basic->Fading` the RGB LED values range from 0-255. What do you have to do so that you get the full range of output voltages from the RGB LED when using your FSR to change the LED color?**

## Flex Sensor, Photo cell, Softpot
Now experiment with the [flex sensor (Optional)](https://www.adafruit.com/product/1070), [photo cell](https://www.adafruit.com/product/161) and [softpot](https://www.adafruit.com/product/178).

<img src=https://cdn-shop.adafruit.com/1200x900/1070-01.jpg alt="flex sensor" width=250>
<img src=https://cdn-shop.adafruit.com/1200x900/161-00.jpg alt="photocell" width=250>
<img src=https://cdn-shop.adafruit.com/1200x900/178-00.jpg alt="softpot" width=250>

**a. What resistance do you need to have in series to get a reasonable range of voltages from each sensor?**

**b. What kind of relationship does the resistance have as a function of stimulus? (e.g., linear?)**

Control the colors of the LED using the above sensors ( including FSR )

## Part D. I2C Sensors 

Some more sophisticated sensors have ICs that measure physical phenomena and then output an digital signal indicating what the analog voltage reading is. 
### Accelerometer
 
The accelerometer is a 3-axis, accelerometer based on the LIS3DH. The LIS3DH is a 3.3V part, but the Adafruit board has an onboard voltage regulator so that the part can be powered on 5V power on the Vin pin.
 
Here's the [Datasheet](https://cdn-shop.adafruit.com/datasheets/LIS3DH.pdf)
 
Unlike the other parts we've used to date, this is a "smart sensor" which can communicate the sensor readings digitally (rather than through an analog voltage) using communication protocols I2C and SPI. 
 
[This example code](https://learn.adafruit.com/adafruit-lis3dh-triple-axis-accelerometer-breakout/arduino) is meant to read values from a 3-axis accelerometer out to a computer over the serial monitor. Test it out! Hint: make sure to read the I2C Wiring section carefully, because the picture uses a different kind of Arduino. Here's a Fritzing diagram of the correct wiring:

https://github.com/FAR-Lab/Interactive-Lab-Hub/tree/master/Lab4/LIS3DH_breadboard.JPG

Adapt the code to indicate what your readings are on the X, Y and Z axes of the accelerometer on your 16x2 LCD panel.

Now set up the RGB LED so that each color is mapped to the X, Y and Z axes accelerations.
 
Get a feel for the data the accelerometer provides. Pick up the Arduino+accelerometer board and tilt it in various directions. Start by holding it so that the accelerometer board is parallel to the ground. Find in which direction the X reading increases and decreases; do the same for the Y reading.
 
**a. Include your accelerometer read-out code in your write-up.**


## Part E. Logging values to the EEPROM and reading them back
 
### 1. Reading and writing values to the Arduino EEPROM
The sample code in `File->Examples->EEPROM` shows functions from the [Arduino EEPROM Library](https://www.arduino.cc/en/Reference/EEPROM) to write and read values to Arduino's EEPROM. This [modified version of the SwitchState code](https://github.com/FAR-Lab/Interactive-Lab-Hub/tree/master/Lab4/SwitchState) employs these functions in three different states. Try it out.

**a. Does it matter what actions are assigned to which state? Why?**

**b. Why is the code here all in the setup() functions and not in the loop() functions?**

Each character in the string is a byte. That is, it takes 8-bits to encode a character, so the number of characters in the string we are writing is the number of bytes we are occupying in EEPROM. The [Atmega 328P](https://www.microchip.com/wwwproducts/en/atmega328p) at the heart of the Arduino has 1024 bytes of internal [EEPROM](http://en.wikipedia.org/wiki/EEPROM) Memory (which is separate from the 32KB of [Program memory](https://en.wikipedia.org/wiki/Read-only_memory) it has for the code it is running.)

**c. How many byte-sized data samples can you store on the Atmega328?**

**d. How would you get analog data from the Arduino analog pins to be byte-sized? How about analog data from the I2C devices?**

**e. Alternately, how would we store the data if it were bigger than a byte? (hint: take a look at the [EEPROMPut](https://www.arduino.cc/en/Reference/EEPROMPut) example)**

Modify the code to take in analog values from your sensors and print them back out to the Arduino Serial Monitor.

### 2. Design your logger
You've been thinking at a high level about a data logger and what it is used for; now you need to adapt that to the specific implementation. 


A lot of the art of data logging is being clever about how to use the sensor. Feel free to engage the teaching team for advice.

Your data logger will have two main modes: one where it logs data and another where it plays the data back. Think a little about what sensors you would like to log data from and how you would like to display your data. Create a state diagram sketch that indicates how you'd like to switch between one mode and the other, and also what you'd like the program to do in each state. This can help you decide what buttons or knobs might be useful for your design.
 
You might make changes to your design before this lab is complete.
 
**a. Turn in a copy of your final state diagram.**

## Part G. Create your own data logger!
Now it's up to you to integrate the software and hardware necessary to interface with your data logger! Your logger should be able to record a stream of analog data (at a sample rate of your desire) and then play it back at some later point in time on your display of choice.
 
**a. Record and upload a short demo video of your logger in action.**


# Lab5

# Integrated Interactive Device

***

For this week’s lab, you will design and build an autonomous device that incorporates:

* Physical Fabrication
* Actuation
* Sensing/Input
* Timing
* Sound

As a guide, we have included instructions to get you most of the way through designing a Jack-in-a-Box. Feel free to explore alternatives to the basic design. For example, if you turn the box on its side, you could have a mouse trap, or a cat door. 


## In the report
Show photos and a video of your final design in action.

Include your sketches and designs for your device, including for ideas you didn't pursue this time.


## Basic Cardboard Box construction

Building off of the strip box from [Lab 3](https://github.com/FAR-Lab/Developing-and-Designing-Interactive-Devices/wiki/Lab-03), this box design is built from two cardboard strips that are the same width X.

This design can be made by scoring two long strips of corrugated cardboard of width X, with the following measurements:

| <---- X ----> <br> <sub><sup>+ thickness of cardboard</sup></sub> | <---- X ----> |
| --- | --- | --- | 

| <---- X ----> | <---- X ----> | <---- X ----> | <---- X ----> |
| --- | --- | --- | --- |


Use an Olfa knife with a cutting mat to cut out your pattern, using 2 cuts to score the cardboard strip at the bends and 3 cuts to cut. (A second mat can be used as a straight edge, and you can use one strip to measure out X on the other.)

![](https://github.com/FAR-Lab/Developing-and-Designing-Interactive-Devices/blob/2020Fall/Lab5/images/IMG_0550.jpeg?raw=true)

Fold the flaps up, and cut the as necessary to level the sides. 

Hot glue the two pieces in a 't', with the 3-segment strip on the bottom. You have a few seconds, while the glue is hot, to make sure the pieces are lined up correctly before the glue cools and sets.  The weight of the double cardboard bottom helps to make the box stable.

![](https://github.com/FAR-Lab/Developing-and-Designing-Interactive-Devices/blob/2020Fall/Lab5/images/IMG_0552.jpeg?raw=true)
![](https://github.com/FAR-Lab/Developing-and-Designing-Interactive-Devices/blob/2020Fall/Lab5/images/IMG_0553.jpeg?raw=true)

On the side flap where you plan to mount the servo motor, use a bead of hot glue along the edge to join the flaps together. Hold the flaps for a few seconds until the hot glue sets. 

![](https://github.com/FAR-Lab/Developing-and-Designing-Interactive-Devices/blob/2020Fall/Lab5/images/IMG_0554.jpeg?raw=true)

DO NOT GLUE THE OTHER SIDE FLAP. 

## Make a cardboard servo motor mount

The cardboard mount holds the servo motor against the side of the box. 

![](https://github.com/FAR-Lab/Developing-and-Designing-Interactive-Devices/blob/2020Fall/Lab5/images/IMG_0555.jpeg?raw=true)

This can be made with strip of cardboard scrap of width X, where X > the height of the servo motor

| F length of flap | D <br><sub><sup>= depth of servo to the flange</sup></sub> | W width of the servo <br><sub><sup>+ two cardboard thicknesses</sup></sub> | D <br><sub><sup>= depth of servo to the flange</sup></sub> | F length of flap|
| --- | --- | --- | --- | --- | 

Cut a square hole in the middle of the strip for the rectangular face of the servo to fit through.

Hot glue the flaps and the back of the servo and stick this in the back corner of the box, with the pivot of the servo near the lid. As before, you will need to hold things in place for a bit while the hot glue sets.

![](https://github.com/FAR-Lab/Developing-and-Designing-Interactive-Devices/blob/2020Fall/Lab5/images/IMG_0556.jpeg?raw=true)![](https://github.com/FAR-Lab/Developing-and-Designing-Interactive-Devices/blob/2020Fall/Lab5/images/IMG_0557.jpeg?raw=true)

** include a photo of your box and servo mount **

## Make the service panel for your box. 

Check to make sure your breadboard and battery fit in. To make programming easier, orient things so the USB cable faces the open side of the box. 

![](https://github.com/FAR-Lab/Developing-and-Designing-Interactive-Devices/blob/2020Fall/Lab5/images/IMG_0558.jpeg?raw=true)

Use shipping tape to make slick patches on the sides of the box, and use removable blue tape (with the ends folded under to make grab tabs) to make a reclosable service panel for your box.

![](https://github.com/FAR-Lab/Developing-and-Designing-Interactive-Devices/blob/2020Fall/Lab5/images/IMG_0559.jpeg?raw=true)
![](https://github.com/FAR-Lab/Developing-and-Designing-Interactive-Devices/blob/2020Fall/Lab5/images/IMG_0560.jpeg?raw=true)![](https://github.com/FAR-Lab/Developing-and-Designing-Interactive-Devices/blob/2020Fall/Lab5/images/IMG_0561.jpeg?raw=true)

** include a photo of your box closed  **


## Electronics

![electronics circuit](https://user-images.githubusercontent.com/54110697/64988326-35758180-d899-11e9-9473-b1610101d91b.jpg)

Tip: If you don't have the 9V connector, you just need to make sure that the micro controller is plugged into your computer, for power. 

### Program your device

Load the [example](https://github.com/FAR-Lab/Developing-and-Designing-Interactive-Devices/blob/2019Fall/Lab5/JackInABox.ino) previously downloaded.

You can also make your own program but make sure you put HIGH digital value to pin 5 if you connected the circuit as the one in the electronics part.

Pay attention that you can change the position of close and open box in the following lines:

#define closePos  10

#define openPos   110


## Make your box open using the servo motor

You'll have to hot glue an arm to the servo motor arm to push back the lid. How should that arm be designed?

** include a photo of your arm design  **

## Putting it all together
***
Think about where each component should go, and assemble your box so that the servo motor opens the box.

** include a video of the box opening  **

## Create Jack

Using cardboard, paper, or found objects, make a jack that pops out when the top opens. 

Here are useful links:

[How to make a paper spring](https://bookzoompa.wordpress.com/2010/03/14/how-to-make-a-paper-spring/)
[How to Use Slicer to make 3D shapes using stacked slices of laser (or Olfa) -cut cardboard](https://core-electronics.com.au/tutorials/using-slicer-for-fusion360-for-laser-cutting-tutorial.html)

** include drawings, sketches or links to any part files used for creating Jack   **

** include a video of the finished design   **

## Lab Submission
***
For your write up, include:
1.	Your Arduino code.
2.	.stl or .svg files for your Jack — if you use some other technique, include the respective supporting material.
3.	At least one photo-studio-quality photo of your box closed, and another photo of your box open. 

4.	A video of your box in action.
